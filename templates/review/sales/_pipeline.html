<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Pipeline</h5>
    </div>
    <div class="card-body">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Opportunity Name</th>
                    <th>Follow Up Date</th>
                    <th>Tasks</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                {% for pipeline_item in pipeline %}
                <tr>
                    <td><a href="/opportunity/{{ pipeline_item.opportunity_id }}">{{ pipeline_item.name }}</a></td>
                    <td>{{ pipeline_item.follow_up_date | convert_to_ist | format_date_time }}</td>
                    <td>
                        <button type="button" class="btn btn-link p-0" data-bs-toggle="modal" onclick="listTasks({{ pipeline_item.opportunity_id }})">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                                <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                            </svg>    
                        </button>   
                        &nbsp;
                        <button type="button" class="btn btn-link p-0" data-bs-toggle="modal" onclick="showCreateTaskModal({{ pipeline_item.opportunity_id }},'{{ pipeline_item.name }}')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                            </svg>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-link p-0" data-bs-toggle="modal" data-bs-target="#taskModal{{ pipeline_item.opportunity_id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                                <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                            </svg>    
                        </button>
                        &nbsp;
                        <button type="button" class="btn btn-link p-0" data-bs-toggle="modal" data-bs-target="#taskModal{{ pipeline_item.opportunity_id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="card-footer">
        <nav aria-label="pipeline pagination">
            <ul class="pagination justify-content-start">
                {% if pipeline_page > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="?pipeline_page=1">First</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?pipeline_page={{ pipeline_page - 1 }}">&laquo; Previous</a>
                    </li>
                {% endif %}
                
                {% set start_page = pipeline_page - 2 if pipeline_page > 2 else 1 %}
                {% set end_page = start_page + 4 if start_page + 4 <= pipeline_count else pipeline_count %}
                {% set start_page = end_page - 4 if end_page - 4 > 0 else 1 %}
                
                {% for p in range(start_page, end_page + 1) %}
                    <li class="page-item {% if p == pipeline_page %}active{% endif %}">
                        <a class="page-link" href="?pipeline_page={{ p }}">{{ p }}</a>
                    </li>
                {% endfor %}
                
                {% if pipeline_page < pipeline_count %}
                    <li class="page-item">
                        <a class="page-link" href="?pipeline_page={{ pipeline_page + 1 }}">Next &raquo;</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?pipeline_page={{ pipeline_count }}">Last</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>

